#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct package {
    char *id;
    int weight;
};

struct post_office {
    int packages_count;
    struct package *packages;
    int min_weight;
    int max_weight;
};

struct town {
    char *name;
    int offices_count;
    struct post_office *offices;
};

typedef struct package package;
typedef struct post_office post_office;
typedef struct town town;

void print_all_packages(town t) {
    printf("%s:\n", t.name);
    for(int i = 0; i < t.offices_count; i++){
        printf("\t%d:\n", i);
        for(int j = 0; j < t.offices[i].packages_count; j++){
            printf("\t\t%s\n", t.offices[i].packages[j].id);
        }
    }
}

void send_all_acceptable_packages(post_office *source, post_office *target){
    int new_target_count = target->packages_count;

    for(int i = 0; i < source->packages_count; i++){
        int w = source->packages[i].weight;

        // Check if package fits target rules
        if(w >= target->min_weight && w <= target->max_weight){

            // Add to target
            target->packages = realloc(target->packages,
                    sizeof(package) * (new_target_count + 1));

            target->packages[new_target_count] = source->packages[i];
            new_target_count++;

            // Remove from source
            for(int j = i; j < source->packages_count - 1; j++){
                source->packages[j] = source->packages[j + 1];
            }

            source->packages_count--;
            i--; // Because we removed one element
        }
    }

    target->packages_count = new_target_count;
}

town town_with_most_packages(town *towns, int towns_count){
    int max_packages = -1;
    town *best = NULL;

    for(int i = 0; i < towns_count; i++){
        int current_total = 0;

        for(int j = 0; j < towns[i].offices_count; j++){
            current_total += towns[i].offices[j].packages_count;
        }

        if(current_total > max_packages){
            max_packages = current_total;
            best = &towns[i];
        }
    }

    return *best;
}

town* find_town(town *towns, int towns_count, char *name){
    for(int i = 0; i < towns_count; i++){
        if(strcmp(towns[i].name, name) == 0){
            return &towns[i];
        }
    }
    return NULL;
}

int main(){
    int towns_count;
    scanf("%d", &towns_count);

    town *towns = malloc(sizeof(town) * towns_count);

    for(int i = 0; i < towns_count; i++){
        towns[i].name = malloc(100);
        scanf("%s", towns[i].name);

        scanf("%d", &towns[i].offices_count);
        towns[i].offices = malloc(sizeof(post_office) * towns[i].offices_count);

        for(int j = 0; j < towns[i].offices_count; j++){
            scanf("%d %d %d",
                  &towns[i].offices[j].packages_count,
                  &towns[i].offices[j].min_weight,
                  &towns[i].offices[j].max_weight);

            int pc = towns[i].offices[j].packages_count;
            towns[i].offices[j].packages = malloc(sizeof(package) * pc);

            for(int k = 0; k < pc; k++){
                towns[i].offices[j].packages[k].id = malloc(100);
                scanf("%s", towns[i].offices[j].packages[k].id);
                scanf("%d", &towns[i].offices[j].packages[k].weight);
            }
        }
    }

    int q;
    scanf("%d", &q);

    while(q--){
        int type;
        scanf("%d", &type);

        if(type == 1){
            char name[100];
            scanf("%s", name);

            town *t = find_town(towns, towns_count, name);
            print_all_packages(*t);
        }
        else if(type == 2){
            char town1[100], town2[100];
            int index1, index2;

            scanf("%s %d %s %d",
                  town1, &index1,
                  town2, &index2);

            town *sourceTown = find_town(towns, towns_count, town1);
            town *targetTown = find_town(towns, towns_count, town2);

            send_all_acceptable_packages(
                &sourceTown->offices[index1],
                &targetTown->offices[index2]
            );
        }
        else if(type == 3){
            town result = town_with_most_packages(towns, towns_count);
            printf("Town with the most number of packages is %s\n", result.name);
        }
    }

    return 0;
}
